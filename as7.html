<html>

<head>

<link rel="stylesheet" type="text/css" href="CSS\img.css">

<script>

	var IMAGE_PATH = "resources/boardImages/";
	var NUMBER_OF_CARDS = 8;
	var ROWS = 4;
	var COLS = 4;
	
	var images = new Array(NUMBER_OF_CARDS*2);

	function initialize(){
		
		// read in images into an array
		for(var i = 0; i < NUMBER_OF_CARDS*2; i++){
			var image = new Image();
			image.id = "img" + i;
			image.src = IMAGE_PATH + (i%8) + ".jpg";
			images[i] = image;
		}
	
		// shuffle the array of images
		var currentIndex = images.length;
		while (0 !== currentIndex) {
			var randomIndex = Math.floor(Math.random() * currentIndex);
			currentIndex -= 1;
			var temp = images[currentIndex];
			images[currentIndex] = images[randomIndex];
			images[randomIndex] = temp;
		}
		
		// deal the cards
		// TODO animate the dealing process
		var html = "";
		for(var i = 0; i < ROWS; i++){
			html += "<tr>";
			for(var j = 0; j < COLS; j++){
				html += "<td class='border'><div onclick='imageClicked(this);' id='div" + ((i*COLS)+j);
				html += "' class='transparent'><img id='" + i + j + "' src='" + images[(i*COLS)+j].src;
				html += "' height='100' width='100' draggable='false'></div></td>";
			}
			html += "</tr>"
		}
		document.getElementById("board").innerHTML = html;
		//var div = document.getElementById("div0");
		//div.className = "visible";
	}
	
	// TODO animate the image flipping
	// TODO flip the images if they do not match
	function imageClicked(div){
		// search if an image is selected
		if(div.childNodes[0].isMatched){
			alert("This image has already been matched with another. Please select another image.");
			return;
		}
		
		var image = 0;
		for(var i = 0; i < ROWS; i++){
			for(var j = 0; j < COLS; j++){
				if(document.getElementById("" + i + j).isSelected){
					image = document.getElementById("" + i + j);
				}
			}
		}
		
		if(image != 0){
			var child = div.childNodes;
			if (image.src === child[0].src) {
				div.className = "visible";
				matched(div, image);
			}
			else {
				div.className = "visible";
				notMatched(div, image);
			}
		}
		else{
			div.className = "visible";
			var anImage = document.getElementById("" + div.childNodes[0].id);
			anImage.isSelected = true;
		}
	}
	
	function matched(div, image){
		alert("matched");
		
		// deselect
		div.childNodes[0].isSelected = false;
		image.isSelected = false;
		
		// mark matched
		div.childNodes[0].isMatched = true;
		image.isMatched = true;
	}
	
	function notMatched(div, image){
		alert("not matched");
		// deselect
		div.childNodes[0].isSelected = false;
		image.isSelected = false;
		
		// make transparent
		div.className = "transparent";
		image.parentNode.className = "transparent"
	}

</script>

</head>

<body onload="initialize();">

<center><a href="Description.html">DESCRIPTION</a></center>

<br><br><br>

<table id="board" align="center">
</table>

</body>

</html>